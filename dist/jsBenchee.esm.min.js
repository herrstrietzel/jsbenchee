async function e(e=[],s="",r=25,a=!0,i={},l="",o=""){let c={name:s,average:0,lowest:0,highest:0,timings:[]},m=document.getElementById(l),u=i[l],h=[],d=[],g=[],p="",f="",j="",$=0;if(!u){for(let t=0,s=e.length;s&&t<s;t++){let s=e[t],r=s.split(".")?.slice(-1)[0]||null,i=!!r&&("js"===r||"cjs"===r||"mjs"===r),l=s.startsWith("https://")||s.startsWith("http://")||s.startsWith("//"),o=0;s.includes("import")?g.push(s):i||l?h.push(s):(a&&(o=n(s),o>1&&(s="const jsBencheeHarmful=true")),d.push(s))}p=await t(g,l,"module",a,o),f=await t(h,l,"external",a,o),j=await t(d,l,"",a,o)}const w=async(e="",t="",n="",s={},r="")=>{m||(m=document.createElement("iframe"),m.id=r,m.style.display="none",m.sandbox="allow-scripts",document.body.append(m));let a="";if(s[r])a=s[r];else{a=`data:text/html,${encodeURIComponent(`<!DOCTYPE html>\n            <html>\n            <head>\n                <meta charset="UTF-8">\n                ${t}\n            </head>\n            <body>\n                ${e}\n                ${n}\n            </body>\n            </html>`)}`,s[r]=a}m.src=a};return new Promise((e=>{window.addEventListener("message",(function t(n){let{benchmarkResult:s,error:a,value:u}=n.data,h=n.data.hasOwnProperty("benchmarkResult"),d=n.data.ID===l;if(a)c.error=a,e(c);else if(d&&n.data&&h)if(o&&u&&(u="object"==typeof u?Array.isArray(u)?u:JSON.stringify(u):u,c.value=u),c.timings.push(s),$++,$<r)w(p,f,j,i,l);else{window.removeEventListener("message",t);let n=[...c.timings].sort(((e,t)=>e-t));c.lowest=+n[0].toFixed(3);let s=n.reduce(((e,t)=>e+t),0)/n.length;c.average=s;let r=n.reverse(),a=r[0];a>2*s&&(c.timings.splice(c.timings.indexOf(a),1),r.shift(),a=r[0],s=c.timings.reduce(((e,t)=>e+t),0)/c.timings.length,c.average=+s.toFixed(9)),c.highest=+a.toFixed(3),c.timings=[...c.timings],e(c),m.contentWindow.location.replace("about:blank"),performance.clearResourceTimings(),performance.clearMarks(),performance.clearMeasures(),m.remove()}})),w(p,f,j,i,l)}))}async function t(e=[],t="",s="",r=!0,a=""){const i=async(e,t=!0)=>{let s="",r=await fetch(e);if(r.ok){let e=await r.text();if(t){n(e)>1&&(e="const jsBencheeHarmful=true")}s=`data:text/javascript,${encodeURIComponent(e)}`}return s},l=async(e,t=!0)=>{let n=/import\s+(.*?)\s+from\s+['"](.*?)['"]/g,s=Array.from(e.matchAll(n)),r=[];for(let e=0,n=s.length;n&&e<n;e++){let[n,a,l]=s[e],o=await i(l,t),c=n.replaceAll(l,o);r.push(`${c}`)}return{imports:r,body:e.replace(n,"").replaceAll(";","").trim()}};let o="",c=s?"":'"use strict";\n',m="",u="",h="",d=s?`type="${s}" `:s;if(!e.length)return"";if(s&&"external"!==s)for(let t=0;t<e.length;t++){let n=e[t],s=await l(n,r),{imports:a,body:i}=s;u+=a.length?a.join("\n"):"",m+=i?i+"\n":""}else if(s&&"external"===s)for(let t=0;t<e.length;t++){let n=e[t];h+=`<script src="${await i(n,r)}" defer><\/script>\n`}else m=e.join("\n");return o+=`\n        ${h}\n        <script ${d}>\n        ${u}\n        ${c}\n        const iframeID = '${t}';\n        // disable alerts\n        window.alert = () => ()=>{let noalert=''};\n        window.addEventListener('load', () => {\n            const winOrigin = document.referrer;\n            let returnValue = '';\n            try {\n                let duration = 0;\n                const start = performance.now();\n                ${m};\n                duration = performance.now() - start;\n                ${a?`if(typeof ${a} !== 'undefined'){\n        returnValue = ${a} ? ${a} : "";\n    }\n`:""}\n                parent.postMessage({ benchmarkResult: duration, value:returnValue, ID:iframeID, winOrigin: winOrigin}, '*');\n\n            } catch (err) {\n                parent.postMessage({ error: err.message }, '*');\n            }\n        });\n    <\/script>`,o}function n(e){let t=0;const n={};return[{regex:/eval\s*\(/g,score:1},{regex:/new\s+Function\s*\(/g,score:1},{regex:/setTimeout\s*\(/g,score:.1},{regex:/setInterval\s*\(/g,score:.1},{regex:/document\.write\s*\(/g,score:.5},{regex:/innerHTML\s*=/g,score:.3}].forEach((({regex:s,score:r})=>{const a=[...e.matchAll(s)];a.length&&(n[s]=a.length,t+=a.length*r)})),(n[/eval\s*\(/g]||n[/new\s+Function\s*\(/g])&&n[/setTimeout\s*\(/g]&&(t+=2),(n[/eval\s*\(/g]||n[/new\s+Function\s*\(/g])&&(n[/document\.write\s*\(/g]||n[/innerHTML\s*=/g])&&(t+=1),+t.toFixed(2)}var s=function({tests:t=[],iterations:n=25,target:s="",render:r=!1,agentDetection:a=!1,exportMD:i=!1,security:l=!0,multipass:o=1,multitask:c=!0,includeColumns:m=[],addCSS:u=!0,returnVar:h=""}={}){return new Promise((async d=>{this.tests=t,this.iterations=n,this.target=s,this.render=r,this.agentDetection=a,this.includeColumns=m,this.multipass=o,this.multitask=c,this.exportMD=i,this.security=l,this.addCSS=u,this.returnVar=h;let g=a?function(){let e="",t=[],n="",s="";if(navigator.userAgentData)({brands:t,platform:s}=navigator.userAgentData),n=t.slice(-1)[0],e=`${n.brand}/${n.version} ${s}`;else if(navigator.userAgent){let t=navigator.userAgent.split(" ");n=t.slice(-1)[0],s=t[1].replace(/\(/g,""),e=`${n} ${s}`}return e}():"";const p=(e="",t=0,n=!1,s=1,r=!1,a=[])=>{let i=n?`<p class="jsBenchee-p"><strong>Agent:</strong> ${e} <strong>Iterations:</strong> ${t}  <strong>Multipass:</strong> ${s} <strong>Multitask:</strong>${r}<p>`:`<p class="jsBenchee-p"><strong>Iterations:</strong> ${t}  <strong>Multipass:</strong> ${s} <strong>Multitask:</strong>${r}<p>`,l=`\n        <div class="jsBenchee-wrap">\n            <p class="jsBenchee-heading">Benchmarking <strong>${a.map((e=>`»${e.name}«`)).join(", ")}</strong>\n                <span class="jsBenchee-progress">– please wait \n                <span class="jsBenchee-progress-spinner"></span>\n            </span>\n            </p>\n            <section class="jsBenchee-section jsBenchee-summary">\n            ${i}\n            <p class="jsBenchee-p"><strong>Note:</strong> It is recommended to close them while running benchmark test for more realistic results.<p>\n            </section>\n            <section class="jsBenchee-section jsBenchee-results"></section>\n            <section class="jsBenchee-section jsBenchee-conclusion"></section>\n            <details class="jsBenchee-details jsBenchee-markdown">\n                <summary class="jsBenchee-summary">MD output</summary>\n                <pre class="jsBenchee-pre"><code class="jsBenchee-md"></code></pre>\n            </details>\n        </div>`,o=(new DOMParser).parseFromString(l,"text/html").querySelector(".jsBenchee-wrap"),c=o.querySelector(".jsBenchee-results"),m=o.querySelector(".jsBenchee-md");return{reportWrap:o,resultWrap:c,benchmarkMD:m}};let f={results:[],names:[...new Set(t.map((e=>e.name)))],agent:g,iterations:n,multipass:o,multitask:c,returnVar:h},j={};u&&r&&await async function(){let e=(()=>{let e="";try{e=(new Error).stack.split("\n").map((e=>e.split(" ").filter(Boolean)))[1].slice(-1)[0].replace(/\(|\)/g,"").split("/").slice(0,-1).join("/")}catch{e=performance.getEntries().slice(-1)[0].name.split("/").slice(0,-1).join("/")}return console.log("url",e),e})()+"/jsBenchee.css",t=await fetch(e);if(t.ok){let e=await t.text(),n=document.getElementById("jsBencheeStyles");n||(n=document.createElement("style"),n.textContent=e,document.head.append(n))}}(),await(async()=>{const i=(e,t)=>{for(let n in e){let s=e[n],r=t[n];Array.isArray(s)?e[n]=[...s,...r]:isNaN(s)||(e[n]=(s+r)/2)}return e};let u,d,$;if(r){if(({reportWrap:u,resultWrap:d,benchmarkMD:$}=p(g,n,a,o,c,t)),!(s=s&&r?document.querySelector(`${s}`):null)){let e=document.createElement("article");e.id=s.replace(/#|\./gi,""),s=e,document.body.append(s)}s.append(u)}o=o||1;const w=t.map((()=>crypto.randomUUID()));for(let s=0;s<o;s++)if(c){let r=t.map(((t,s)=>e(t.scripts,t.name,n,l,j,w[s],h).catch((e=>({name:t.name,error:e.message,average:0,iterations:[],results:[]})))));(await Promise.allSettled(r)).forEach((e=>{let t=e.value;if(0===s)f.results.push(t);else if(s>0&&o>1){let e=f.results.find((e=>e.name===t.name));i(e,t)}}))}else for(let r=0,a=t.length;a&&r<a;r++){const{scripts:a,name:c}=t[r],m=await e(a,c,n,l,j,w[r],h);if(0===s)f.results.push(m);else if(s>0&&o>1){let e=f.results.find((e=>e.name===m.name));i(e,m)}}let{html:y,md:B}=function(e,t=[]){let{results:n,agent:s="",names:r,iterations:a,multipass:i,multitask:l}=e;n.sort(((e,t)=>e.average-t.average));let o="";0===n[0].average&&(o+=`»${n[0].name}« could not be benchmarked`,n.shift());let c="";c+='<table class="jsBenchee-table">',t.length&&(n=((e,t=[])=>t.length?e.map((e=>{const n={};return(t&&t.length?t:Object.keys(e)).forEach((t=>{e.hasOwnProperty(t)&&(n[t]=e[t])})),n})):e)(n,t)),c+='<thead class="jsBenchee-thead">\n<tr class="jsBenchee-tr">';let m=Object.keys(n[0]);c+=m.map((e=>`<th class="jsBenchee-th">${e}</th>`)).join("\n"),c+="</tr>\n</thead>";let u="";u+=`**Scripts:** ${r.join(", ")}  \n`,u+=s?`**Agent:** ${s} `:"",u+=i?`**Multipass:** ${i} `:"",u+=l?`**Multitask:** ${l} `:"",u+=`**Iterations:** ${a} \n\n`,u+="| "+m.map(((e,t)=>`${e} | `)).join(" ")+"\n",u+="| "+m.map(((e,t)=>0===t?":--- | ":"---: | ")).join(" ")+"\n",c+='<tbody class="jsBenchee-tbody">';let h=Object.keys(n[0]);n.forEach(((e,t)=>{c+='<tr class="jsBenchee-tr">',u+="| ";for(let t=0;t<h.length;t++){let n=h[t],s=e[n];s=Array.isArray(s)?s.map((e=>e&&!isNaN(e)?+e.toFixed(3):e)).join(", "):s,!isNaN(s)&&s&&(s="average"===n?+s.toFixed(1):+s.toFixed(3)),c+=`<td class="jsBenchee-td  jsBenchee-td-${n}"><span class="jsBenchee-td-label">${n}:</span> <span class="jsBenchee-td-value jsBenchee-td-value-${n}">${s}</span></td>`,u+=` ${s} | `}c+="</tr>",u+="\n"})),c+="</tbody>",c+="</table>",n.sort(((e,t)=>e.average-t.average));let d=n[0],g=+d.average.toFixed(3),p=n.length,f='<ul class="jsBenchee-ul">',j="";for(let e=0;p&&e<p;e++){let t=n[e],s=1,{name:r,average:a,timings:i}=t,l="";0===e?l=`»${d.name}« is the fastest executing with an average of ${g} ms`:(s=+(a/g).toFixed(3),l=`»${r}« is ~ ${s} times / ~ ${+(100*(s-1)).toFixed(0)}% slower than »${d.name}«`),f+=`<li class="jsBenchee-li">${l}</li>`,j+=`* ${l}  \n`}return o&&(f+=`<li class="jsBenchee-li">${o}</li>`,j+=`* ${o}  \n`),f+="</ul>",c+=f,u+="\n \n"+j,{html:c,md:u}}(f,m);f.resultMd=B,f.resultHtml=y,f.resultsJSON=JSON.stringify({agent:g,iterations:n,results:f.results}),r&&(u.classList.add("jsBenchee-completed"),d.insertAdjacentHTML("beforeend",y),$.textContent="\n"+B),j={}})(),d(f)}))};"undefined"!=typeof window&&(window.jsBenchee=s);export{s as jsBenchee};
